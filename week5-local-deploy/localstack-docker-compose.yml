version: "3.8"

services:
  localstack:
    image: localstack/localstack-pro:latest
    ports:
      - "4566:4566"  # Main LocalStack API endpoint
      - "4571:4571"  # Legacy port (deprecated in newer versions)
    environment:
      - LOCALSTACK_AUTH_TOKEN=ls-yiLatazO-6832-wOrA-TIgI-Cito4778a78f
      - SERVICES=s3,ec2,iam,sts,kms,cloudtrail,guardduty  # AWS services to emulate
      - PERSISTENCE=1 # Enables persistence for LocalStack data
    volumes:  
      - "${LOCALSTACK_VOLUME_DIR:-./volume}:/var/lib/localstack" # Persists data across container restarts
      - "/var/run/docker.sock:/var/run/docker.sock"  # Gives LocalStack access to Docker on your host
